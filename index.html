<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <title>p5.js Example</title>
</head>
<body>
  <script>
    let backgroundImages = [];
    let motifImages = [];
    let buttons = [];
    let counts = {
      'Enjoyment': 0,
      'Disgust': 0,
      'Sadness': 0,
      'Fear': 0,
      'Anger': 0
    };
    let colors = {
      'Enjoyment': '#FFDBC9',
      'Disgust': '#99CC99',
      'Sadness': '#FFFFCC',
      'Fear': '#FFC0CB',
      'Anger': '#D9E5FF'
    };
    let selectedBackground, selectedMotif;

    function preload() {
      backgroundImages[0] = loadImage('https://mooo0ooo.github.io/diary/background1.png');
      backgroundImages[1] = loadImage('https://mooo0ooo.github.io/diary/background2.png');
      backgroundImages[2] = loadImage('https://mooo0ooo.github.io/diary/background3.png');
      backgroundImages[3] = loadImage('https://mooo0ooo.github.io/diary/background4.png');

      motifImages['Enjoyment'] = loadImage('https://mooo0ooo.github.io/diary/sun-removebg-preview.png');
      motifImages['Disgust'] = loadImage('https://mooo0ooo.github.io/diary/shooting_star-removebg-preview.png');
      motifImages['Sadness'] = loadImage('https://mooo0ooo.github.io/diary/moon-removebg-preview.png');
      motifImages['Fear'] = loadImage('https://mooo0ooo.github.io/diary/fireworks-removebg-preview.png');
      motifImages['Anger'] = loadImage('https://mooo0ooo.github.io/diary/star-removebg-preview.png');
    }

    function setup() {
      createCanvas(windowWidth, windowHeight);
      background(255);

      // 画像ボタンを追加（各感情に対応した画像を指定）
      buttons.push(createEmotionalButton('Enjoyment', 'https://example.com/enjoyment.png', 10, 10));
      buttons.push(createEmotionalButton('Disgust', 'https://example.com/disgust.png', 100, 10));
      buttons.push(createEmotionalButton('Sadness', 'https://example.com/sadness.png', 190, 10));
      buttons.push(createEmotionalButton('Fear', 'https://example.com/fear.png', 280, 10));
      buttons.push(createEmotionalButton('Anger', 'https://example.com/anger.png', 370, 10));

      createButton('Check').position(500, 10).mousePressed(displayArtwork);
    }

    function createEmotionalButton(label, imgURL, x, y) {
      // createImgで画像ボタンを作成
      let button = createImg(imgURL, label);
      button.position(x, y);
      button.mousePressed(() => { counts[label]++; });
      return {
        button: button,
        x: x,
        y: y,
        label: label,
        offsetX: random(-1, 1),
        offsetY: random(-1, 1),
        size: random(50, 150)
      };
    }

    function displayArtwork() {
      let totalGroup1 = counts['Enjoyment']; 
      let totalGroup2 = counts['Disgust'] + counts['Sadness'] + counts['Fear'] + counts['Anger'];

      let ratio = totalGroup1 / (totalGroup1 + totalGroup2);
      if (ratio >= 1) {
        selectedBackground = backgroundImages[0];
      } else if (ratio >= 0.6) {
        selectedBackground = backgroundImages[1];
      } else if (ratio >= 0.4) {
        selectedBackground = backgroundImages[2];
      } else {
        selectedBackground = backgroundImages[3];
      }

      let maxCount = Math.max(counts['Enjoyment'], counts['Disgust'], counts['Sadness'], counts['Fear'], counts['Anger']);
      if (maxCount === counts['Enjoyment']) {
        selectedMotif = motifImages['Enjoyment'];
      } else if (maxCount === counts['Disgust']) {
        selectedMotif = motifImages['Disgust'];
      } else if (maxCount === counts['Sadness']) {
        selectedMotif = motifImages['Sadness'];
      } else if (maxCount === counts['Fear']) {
        selectedMotif = motifImages['Fear'];
      } else if (maxCount === counts['Anger']) {
        selectedMotif = motifImages['Anger'];
      }

      drawArtwork();
    }

    function drawArtwork() {
      if (selectedBackground) {
        image(selectedBackground, 0, 0, width, height);
      }

      if (selectedMotif) {
        tint(255, 250);
        image(selectedMotif, width / 2 - 500, height / 2 - 50, 1000, 1000);
        noTint();
      }
    }

    function draw() {
      background(255);

      // すべてのボタンをランダムに移動させ、もやもやを表示
      buttons.forEach(btn => {
        btn.x += random(-1, 1);
        btn.y += random(-1, 1);

        btn.offsetX += random(-0.5, 0.5);
        btn.offsetY += random(-0.5, 0.5);

        btn.size = map(sin(frameCount * 0.05), -1, 1, 50, 150);

        fill(colors[btn.label]);
        noStroke();
        ellipse(btn.x + btn.offsetX, btn.y + btn.offsetY, btn.size, btn.size);

        btn.button.position(btn.x, btn.y);
      });
    }

  </script>
</body>
</html>
