<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <title>感情選択</title>
  <style>
    img {
      display: block;
      position: absolute;
    }
  </style>
</head>
<body>
  <script>
    let backgroundImages = [];
    let motifImages = [];
    let buttons = {};
    let sparkles = [];
    let currentPage = 1; // 1: 選択ページ, 2: アートワークページ
    let selectedEmotion = '';
    let sparkleDuration = 2000; // キラキラの表示時間
    let sparkleColors = {
      'Enjoyment': '#FF4500',
      'Disgust': '#006400',
      'Sadness': '#FFD700',
      'Fear': '#550000',
      'Anger': '#006699'
    };

    function preload() {
      // 背景画像の読み込み
      backgroundImages[0] = loadImage('https://mooo0ooo.github.io/diary/background1.png');
      backgroundImages[1] = loadImage('https://mooo0ooo.github.io/diary/background2.png');
      backgroundImages[2] = loadImage('https://mooo0ooo.github.io/diary/background3.png');
      backgroundImages[3] = loadImage('https://mooo0ooo.github.io/diary/background4.png');

      // モチーフ画像の読み込み
      motifImages['Enjoyment'] = loadImage('https://mooo0ooo.github.io/diary/sun-removebg-preview.png');
      motifImages['Disgust'] = loadImage('https://mooo0ooo.github.io/diary/shooting_star-removebg-preview.png');
      motifImages['Sadness'] = loadImage('https://mooo0ooo.github.io/diary/moon-removebg-preview.png');
      motifImages['Fear'] = loadImage('https://mooo0ooo.github.io/diary/fireworks-removebg-preview.png');
      motifImages['Anger'] = loadImage('https://mooo0ooo.github.io/diary/star-removebg-preview.png');
    }

    function setup() {
      createCanvas(windowWidth, windowHeight);
      positionButtons(); // 現在のページに基づいてボタンを配置
    }

    function draw() {
      if (currentPage === 1) {
        drawSelectionPage(); // 選択ページを描画
      } else {
        drawArtworkPage(); // アートワークページを描画
      }
      drawSparkles(); // キラキラを描画
    }

    function drawSelectionPage() {
      background(255);
      textAlign(CENTER);
      textSize(32);
      text("感情を選択してください", width / 2, height / 4);

      // 感情ボタンを描画
      for (let emotion in buttons) {
        buttons[emotion].show();
      }
    }

    function drawArtworkPage() {
      background(255);
      let selectedBackground = getSelectedBackground(); // 選択された感情に基づく背景を取得
      image(selectedBackground, 0, 0, width, height); // 背景を描画
      drawMotif(); // 選択されたモチーフを描画

      // ダウンロードボタンを描画
      drawDownloadButton();
    }

    function getSelectedBackground() {
      // 選択された感情に基づいて背景を決定
      if (selectedEmotion === 'Enjoyment') {
        return backgroundImages[0];
      } else if (selectedEmotion === 'Disgust') {
        return backgroundImages[1];
      } else if (selectedEmotion === 'Sadness') {
        return backgroundImages[2];
      } else if (selectedEmotion === 'Fear') {
        return backgroundImages[3];
      } else {
        return backgroundImages[0]; // デフォルトは最初の背景
      }
    }

    function drawMotif() {
      // 選択されたモチーフを描画
      if (selectedEmotion) {
        let motifImage = motifImages[selectedEmotion];
        image(motifImage, width / 2 - 50, height / 2 - 50, 100, 100); // モチーフのサイズ調整
      }
    }

    function createSparkles(emotion) {
      let numSparkles = 20; // キラキラの数
      sparkles = []; // 前のキラキラをクリア

      for (let i = 0; i < numSparkles; i++) {
        let x = random(width);
        let y = random(height);
        let size = random(10, 20); // キラキラのサイズ

        sparkles.push({
          x: x,
          y: y,
          size: size,
          color: sparkleColors[emotion],
          alpha: 255
        });
      }

      // 2秒後に消える
      setTimeout(() => {
        sparkles = []; // キラキラを消去
      }, sparkleDuration);
    }

    function drawSparkles() {
      for (let sparkle of sparkles) {
        fill(sparkle.color);
        noStroke();
        ellipse(sparkle.x, sparkle.y, sparkle.size); // キラキラを描画
      }
    }

    function positionButtons() {
      let emotions = ['Enjoyment', 'Disgust', 'Sadness', 'Fear', 'Anger'];
      buttons = {};

      for (let i = 0; i < emotions.length; i++) {
        let emotion = emotions[i];
        buttons[emotion] = createButton(emotion);
        buttons[emotion].position(100 + i * 120, height / 2);
        buttons[emotion].mousePressed(() => handleEmotionButton(emotion));
      }

      // Checkボタンを作成
      let checkButton = createButton('Check');
      checkButton.position(width / 2 - 30, height / 1.5);
      checkButton.mousePressed(displayArtwork);
      buttons['Check'] = checkButton;
    }

    function handleEmotionButton(emotion) {
      selectedEmotion = emotion; // 選択された感情を保存
      createSparkles(emotion); // キラキラを生成
    }

    function displayArtwork() {
      currentPage = 2; // アートワークページに移動
    }

    function drawDownloadButton() {
      let downloadButton = createButton('Download Image');
      downloadButton.position(width / 2 - 30, height - 100);
      downloadButton.mousePressed(downloadImage);
      downloadButton.show(); // ダウンロードボタンを表示
    }

    function downloadImage() {
      saveCanvas('artwork', 'png'); // 画像をPNG形式で保存
    }

    // ウィンドウリサイズ時にキャンバスを再設定
    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      positionButtons(); // ボタンの再配置
    }
  </script>
</body>
</html>
