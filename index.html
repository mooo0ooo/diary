<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <title>p5.js Responsive Example</title>
  <style>
    img {
      display: block;
      position: absolute;
    }
    .emotion-label {
      text-align: center;
    }
  </style>
</head>
<body>
  <script>
    let backgroundImages = [];
    let motifImages = [];
    let emotionsA = ['joy', 'trust', 'fear', 'surprise', 'sadness', 'disgust', 'anger', 'anticipation'];
    let emotionsB = ['ecstasy', 'adoration', 'terror', 'amazement', 'grief', 'loathing', 'rage', 'vigilance'];
    let emotionsC = ['serenity', 'acceptance', 'apprehension', 'distraction', 'pensiveness', 'boredom', 'annoyance', 'interest'];
    
    let positiveEmotions = ['ecstasy', 'joy', 'serenity', 'adoration', 'trust', 'acceptance', 'anticipation', 'interest', 'amazement', 'surprise', 'distraction'];
    let negativeEmotions = ['terror', 'fear', 'apprehension', 'grief', 'sadness', 'pensiveness', 'loathing', 'disgust', 'boredom', 'rage', 'anger', 'annoyance', 'vigilance'];

    let radiusA, radiusB, radiusC;
    let emotionSize;
    let buttons = {}; // 感情ボタンのオブジェクト
    let checkButton;  // 中央のCheckボタン

    let positiveCount = 0;
    let negativeCount = 0;
    let selectedEmotionCounts = {};  // 各感情のクリック数
    let mostSelectedEmotion = '';    // 最も多くクリックされた感情
    let selectedBackground;          // 選択された背景画像

    function preload() {
      // 背景画像やモチーフ画像の読み込み
      backgroundImages[0] = loadImage('https://mooo0ooo.github.io/diary/background1.png');
      backgroundImages[1] = loadImage('https://mooo0ooo.github.io/diary/background2.png');
      backgroundImages[2] = loadImage('https://mooo0ooo.github.io/diary/background3.png');
      backgroundImages[3] = loadImage('https://mooo0ooo.github.io/diary/background4.png');

      motifImages['joy'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/fireworks-removebg-preview.png');
      motifImages['jrust'] = loadImage('https://mooo0ooo.github.io/diary/sun-removebg-preview.png');
      motifImages['fear'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/moon-removebg-preview.png');
      motifImages['surprise'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/thunder.PNG');
      motifImages['sadness'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/shooting_star-removebg-preview.png');
      motifImages['disgust'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/rain.PNG');
      motifImages['anger'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/star-removebg-preview.png');
      motifImages['anticipation'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/balloon.PNG');
      motifImages['ecstasy'] = loadImage('https://mooo0ooo.github.io/diary/rose.PNG');
      motifImages['adoration'] = loadImage('https://mooo0ooo.github.io/diary/tulip.PNG');
      motifImages['terror'] = loadImage('https://mooo0ooo.github.io/diary/yellowFlower.PNG');
      motifImages['amazement'] = loadImage('https://mooo0ooo.github.io/diary/clover.PNG');
      motifImages['grief'] = loadImage('https://mooo0ooo.github.io/diary/futaba.PNG');
      motifImages['loathing'] = loadImage('https://mooo0ooo.github.io/diary/mizuiroFlower.PNG');
      motifImages['rage'] = loadImage('https://mooo0ooo.github.io/diary/blueFlower.PNG');
      motifImages['vigilance'] = loadImage('https://mooo0ooo.github.io/diary/cherryBlossom.PNG');
      motifImages['serenity'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/apple.PNG');
      motifImages['acceptance'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/carrot.PNG');
      motifImages['apprehension'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/egg.PNG');
      motifImages['distraction'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/avocado.PNG');
      motifImages['pensiveness'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/broccoli.PNG');
      motifImages['boredom'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/turnip.PNG');
      motifImages['annoyance'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/fork.PNG');
      motifImages['interest'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/glove.PNG');
    }

    function setup() {
      createCanvas(windowWidth, windowHeight);
      calculateSizes();

      // 感情のボタンを作成
      createEmotionButtons();

      // 中央にCheckボタンを作成
      checkButton = createButton('Check');
      checkButton.position(windowWidth / 2 - 50, windowHeight / 2 - 20);
      checkButton.mousePressed(() => {
        processResult();
      });

      // 各感情のカウントを初期化
      for (let emotion of [...positiveEmotions, ...negativeEmotions]) {
        selectedEmotionCounts[emotion] = 0;
      }
    }

    function draw() {
      clear();
      if (selectedBackground) {
        // 背景画像を表示
        image(selectedBackground, 0, 0, width, height);
      } else {
        background(255); // 白背景
        translate(width / 2, height / 2);

        drawEmotionCircle(emotionsA, radiusA);
        drawEmotionCircle(emotionsB, radiusB);
        drawEmotionCircle(emotionsC, radiusC);
      }
    }

    function drawEmotionCircle(emotions, radius) {
      let angleStep = TWO_PI / emotions.length;

      for (let i = 0; i < emotions.length; i++) {
        let angle = i * angleStep;
        let x = cos(angle) * radius;
        let y = sin(angle) * radius;

         if (buttons[emotions[i]]) {
      buttons[emotions[i]].position(width / 2 + x - emotionSize / 2, height / 2 + y - emotionSize / 2);
    } else {
      console.error(`Button for emotion ${emotions[i]} not found.`);
    }

        // ボタンの位置を更新
        buttons[emotions[i]].position(width / 2 + x - emotionSize / 2, height / 2 + y - emotionSize / 2);
      }
    }

    function createEmotionButtons() {

    for (let emotion of [...positiveEmotions, ...negativeEmotions]) {
    if (motifImages[emotion]) {
      buttons[emotion] = createImg(motifImages[emotion].url).mousePressed(() => handleEmotionButton(emotion));
    } else {
      console.error(`モチーフ画像が見つかりません: ${emotion}`);
    }
  }
      
      // 感情ごとのモチーフ画像をボタンとして作成
      for (let emotion of positiveEmotions) {
        buttons[emotion] = createImg(motifImages[emotion].url).mousePressed(() => handleEmotionButton(emotion));
      }

      for (let emotion of negativeEmotions) {
        buttons[emotion] = createImg(motifImages[emotion].url).mousePressed(() => handleEmotionButton(emotion));
      }

      // ボタンのサイズを設定
      for (let key in buttons) {
        buttons[key].size(emotionSize, emotionSize);
      }
    }

        function calculateSizes() {
      // デバイスに基づくサイズ調整
      let minDim = min(windowWidth, windowHeight);
      radiusA = minDim * 0.15;  // 内側の円
      radiusB = minDim * 0.3;   // 中間の円
      radiusC = minDim * 0.45;  // 外側の円
      emotionSize = minDim * 0.1; // ボタンのサイズを決定
    }

    function handleEmotionButton(emotion) {
      // ポジティブかネガティブかを判定してカウント
      if (positiveEmotions.includes(emotion)) {
        positiveCount++;  // ポジティブ感情のカウントを増加
      } else if (negativeEmotions.includes(emotion)) {
        negativeCount++;  // ネガティブ感情のカウントを増加
      }

      // 選択された感情のカウントを更新
      selectedEmotionCounts[emotion]++;
    }

    function processResult() {
      // すべてのボタンを非表示にする
      for (let key in buttons) {
        buttons[key].hide();
      }
      checkButton.hide();

      // 最も多く選択された感情を取得
      mostSelectedEmotion = Object.keys(selectedEmotionCounts).reduce((a, b) => selectedEmotionCounts[a] > selectedEmotionCounts[b] ? a : b);

      // ＋と－の感情の比率に応じて背景画像を選択
      let ratio = positiveCount / (positiveCount + negativeCount);
      if (ratio === 1) {
        selectedBackground = backgroundImages[0];  // ＋:－ = 10:0
      } else if (ratio >= 0.6) {
        selectedBackground = backgroundImages[1];  // ＋:－ = 6:4
      } else if (ratio >= 0.4) {
        selectedBackground = backgroundImages[2];  // ＋:－ = 4:6
      } else {
        selectedBackground = backgroundImages[3];  // ＋:－ = 0:10
      }

      // 最も多く押された感情のモチーフ画像を中央に表示
      let motif = motifImages[mostSelectedEmotion];
      image(motif, width / 2 - 100, height / 2 - 100, 200, 200);  // 200x200の正方形で表示
    }

    function windowResized() {
      // ウィンドウサイズが変更された際にキャンバスとサイズを調整
      resizeCanvas(windowWidth, windowHeight);
      calculateSizes();
    }
  </script>
</body>
</html>
