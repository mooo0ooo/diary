<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <title>p5.js Particle Effect Example</title>
  <style>
    .button {
      border: none;
      background: transparent;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <script>
    let particles = []; // キラキラパーティクルを格納する配列
    let particleDuration = 120; // パーティクルが表示されるフレーム数 (2秒間)

    let buttons = {};

    function setup() {
      createCanvas(windowWidth, windowHeight);
      background(255);

      // 感情のボタンを作成
      buttons.enjoyment = createButton('Enjoyment').class('button').mousePressed(() => {
        createParticles(width / 2, height / 2, '#FF4500'); // Enjoymentのキラキラ
      });
      buttons.disgust = createButton('Disgust').class('button').mousePressed(() => {
        createParticles(width / 2, height / 2, '#006400'); // Disgustのキラキラ
      });
      buttons.sadness = createButton('Sadness').class('button').mousePressed(() => {
        createParticles(width / 2, height / 2, '#FFD700'); // Sadnessのキラキラ
      });
      buttons.fear = createButton('Fear').class('button').mousePressed(() => {
        createParticles(width / 2, height / 2, '#550000'); // Fearのキラキラ
      });
      buttons.anger = createButton('Anger').class('button').mousePressed(() => {
        createParticles(width / 2, height / 2, '#006699'); // Angerのキラキラ
      });

      positionButtons();
    }

    // キラキラパーティクルを生成する関数
    function createParticles(x, y, color) {
      for (let i = 0; i < 50; i++) { // 50個のキラキラを生成
        let particle = {
          x: random(0, width), // ランダムな位置
          y: random(0, height), // ランダムな位置
          size: random(10, 30),
          color: color,
          lifetime: particleDuration, // 表示される残り時間
          shape: random(['star', 'hexagon', 'circle', 'diamond']), // ランダムな形状
          filled: random([true, false]) // 塗りつぶしあり/なしをランダムに設定
        };
        particles.push(particle);
      }
    }

    function draw() {
      background(255);

      // パーティクルの描画
      for (let i = particles.length - 1; i >= 0; i--) {
        let particle = particles[i];
        drawParticle(particle);

        // パーティクルの寿命を減少させる
        particle.lifetime--;
        if (particle.lifetime <= 0) {
          particles.splice(i, 1); // 寿命が尽きたパーティクルを削除
        }
      }

      positionButtons();
    }

    // パーティクルを描画する関数
    function drawParticle(particle) {
      push();
      translate(particle.x, particle.y);
      stroke(particle.color);
      if (particle.filled) {
        fill(particle.color);
      } else {
        noFill();
      }
      strokeWeight(2);

      // 形状に応じた描画
      if (particle.shape === 'star') {
        drawStar(0, 0, particle.size / 2, particle.size, 5); // 星
      } else if (particle.shape === 'hexagon') {
        drawHexagon(0, 0, particle.size / 2); // 六芒星
      } else if (particle.shape === 'circle') {
        ellipse(0, 0, particle.size, particle.size); // 円
      } else if (particle.shape === 'diamond') {
        drawDiamond(0, 0, particle.size); // ダイヤ
      }

      pop();
    }

    // 星形を描画する関数
    function drawStar(x, y, radius1, radius2, npoints) {
      let angle = TWO_PI / npoints;
      let halfAngle = angle / 2.0;
      beginShape();
      for (let a = 0; a < TWO_PI; a += angle) {
        let sx = x + cos(a) * radius2;
        let sy = y + sin(a) * radius2;
        vertex(sx, sy);
        sx = x + cos(a + halfAngle) * radius1;
        sy = y + sin(a + halfAngle) * radius1;
        vertex(sx, sy);
      }
      endShape(CLOSE);
    }

    // 六芒星を描画する関数
    function drawHexagon(x, y, radius) {
      beginShape();
      for (let i = 0; i < 6; i++) {
        let angle = TWO_PI / 6 * i;
        let sx = x + cos(angle) * radius;
        let sy = y + sin(angle) * radius;
        vertex(sx, sy);
      }
      endShape(CLOSE);
    }

    // ダイヤ形を描画する関数
    function drawDiamond(x, y, size) {
      beginShape();
      vertex(x, y - size / 2);
      vertex(x + size / 2, y);
      vertex(x, y + size / 2);
      vertex(x - size / 2, y);
      endShape(CLOSE);
    }

    // ボタンの位置とサイズを画面サイズに基づいて調整する関数
    function positionButtons() {
      let buttonSize = min(windowWidth, windowHeight) * 0.08; // ボタンの大きさを画面のサイズに応じて調整
      let buttonMargin = buttonSize * 0.2; // ボタン間のマージン
      let topMargin = windowHeight * 0.05; // 上からのマージン

      // ボタンの横方向の中心配置
      let totalWidth = (buttonSize * 5) + (buttonMargin * 4); // 5つのボタン幅と間のマージンの合計
      let startX = (windowWidth - totalWidth) / 2;  // 画面中央から配置開始

      // 各感情ボタンの位置を設定
      buttons.enjoyment.position(startX, topMargin).size(buttonSize, buttonSize);
      buttons.disgust.position(startX + (buttonSize + buttonMargin), topMargin).size(buttonSize, buttonSize);
      buttons.sadness.position(startX + (buttonSize + buttonMargin) * 2, topMargin).size(buttonSize, buttonSize);
      buttons.fear.position(startX + (buttonSize + buttonMargin) * 3, topMargin).size(buttonSize, buttonSize);
      buttons.anger.position(startX + (buttonSize + buttonMargin) * 4, topMargin).size(buttonSize, buttonSize);
    }

    // ウィンドウリサイズ時にキャンバスとボタンの位置を再設定
    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      positionButtons();  // ボタンの再配置
    }

  </script>

</body>
</html>
