<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <title>p5.js Responsive Example</title>
  <style>
    img {
      display: block;
      position: absolute;
    }
    .emotion-label {
      font-family: 'Arial', sans-serif; 
      font-size: 16px;
      text-align: center;
      color: #333;
      position: absolute;
      width: 100px;
    }
  </style>
</head>
<body>
  <script>
    let backgroundImages = [];
    let motifImages = [];
    let countJoy = 0, countTrust = 0, countFear = 0, countSurprise = 0, countSadness = 0, countDisgust = 0, countAnger = 0, countAnticipation = 0, countEcstasy = 0, countAdoration = 0, countTerror = 0, countAmazement = 0, countGrief = 0, countLoathing = 0, countRage = 0, countVigilance = 0;
    let countSerenity = 0, countAcceptance = 0, countApprehension = 0, countDistraction = 0, countPensiveness = 0, countBoredom = 0, countAnnoyance = 0, countInterest = 0;
    
    let selectedBackground, selectedMotif;

    let buttons = {};
    let sparkles = [];
    let sparkleDuration = 2000; // キラキラの表示時間
    let sparkleColors = {
      'Joy': '#B50000',
      'Trust': '#E58351',
      'Fear': '#FFD036',
      'Surprise': '#36C238',
      'Sadness': '#008704',
      'Disgust': '#5D94A6',
      'Anger': '#00699D',
      'Anticipation': '#FF7CC0',
      'Ecstasy': '#7F0000',
      'Adoration': '#B2653E',
      'Terror': '#CCA32A',
      'Amazement': '#003A00',
      'Grief': '#00496B',
      'Loathing': '#406672',
      'Rage': '#278E27',
      'Vigilance': '#CC6399',
      'Serenity': '#E50000',
      'Acceptance': '#FF7F3F',
      'Apprehension': '#FF8F00',
      'Distraction': '#00BA03',
      'Pensiveness': '#008ED1',
      'Boredom': '#7FCBE2',
      'Annoyance': '#B2E4B2',
      'Interest': '#FF7CC0'
    };

    function preload() {
      // 背景画像の読み込み
      backgroundImages[0] = loadImage('https://mooo0ooo.github.io/diary/background1.png');
      backgroundImages[1] = loadImage('https://mooo0ooo.github.io/diary/background2.png');
      backgroundImages[2] = loadImage('https://mooo0ooo.github.io/diary/background3.png');
      backgroundImages[3] = loadImage('https://mooo0ooo.github.io/diary/background4.png');

      // モチーフ画像の読み込み
      motifImages['Joy'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/fireworks-removebg-preview.png');
      motifImages['Trust'] = loadImage('https://mooo0ooo.github.io/diary/sun-removebg-preview.png'); 
      motifImages['Fear'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/moon-removebg-preview.png');
      motifImages['Surprise'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/thunder.PNG');
      motifImages['Sadness'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/shooting_star-removebg-preview.png');
      motifImages['Disgust'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/rain.PNG');
      motifImages['Anger'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/star-removebg-preview.png');
      motifImages['Anticipation'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/balloon.PNG');

      motifImages['Ecstasy'] = loadImage('https://mooo0ooo.github.io/diary/rose.PNG');
      motifImages['Adoration'] = loadImage('https://mooo0ooo.github.io/diary/tulip.PNG');
      motifImages['Terror'] = loadImage('https://mooo0ooo.github.io/diary/yellowFlower.PNG');
      motifImages['Amazement'] = loadImage('https://mooo0ooo.github.io/diary/clover.PNG');
      motifImages['Grief'] = loadImage('https://mooo0ooo.github.io/diary/futaba.PNG');
      motifImages['Loathing'] = loadImage('https://mooo0ooo.github.io/diary/mizuiroFlower.PNG');
      motifImages['Rage'] = loadImage('https://mooo0ooo.github.io/diary/blueFlower.PNG');
      motifImages['Vigilance'] = loadImage('https://mooo0ooo.github.io/diary/cherryBlossom.PNG');

      motifImages['Serenity'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/apple.PNG');  
      motifImages['Acceptance'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/carrot.PNG'); 
      motifImages['Apprehension'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/egg.PNG');
      motifImages['Distraction'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/avocado.PNG');
      motifImages['Pensiveness'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/broccoli.PNG');
      motifImages['Boredom'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/turnip.PNG');
      motifImages['Annoyance'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/fork.PNG');
      motifImages['Interest'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/glove.PNG');

    }

    function setup() {
      createCanvas(windowWidth, windowHeight);
      background(255);

      // 感情のボタンを画像として作成
      buttons.joy = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/fireworks-removebg-preview.png', 'Joy').mousePressed(() => { handleEmotionButton('Joy'); });
      buttons.trust = createImg('https://mooo0ooo.github.io/diary/sun-removebg-preview.png', 'Trust').mousePressed(() => { handleEmotionButton('Trust'); });
      buttons.fear = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/moon-removebg-preview.png', 'Fear').mousePressed(() => { handleEmotionButton('Fear'); });
      buttons.surprise = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/thunder.PNG', 'Surprise').mousePressed(() => { handleEmotionButton('Surprise'); });
      buttons.sadness = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/shooting_star-removebg-preview.png', 'Sadness').mousePressed(() => { handleEmotionButton('Sadness'); });
      buttons.disgust = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/rain.PNG', 'Disgust').mousePressed(() => { handleEmotionButton('Disgust'); });
      buttons.anger = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/star-removebg-preview.png', 'Anger').mousePressed(() => { handleEmotionButton('Anger'); });
      buttons.anticipation = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/balloon.PNG', 'Anticipation').mousePressed(() => { handleEmotionButton('Anticipation'); });

      buttons.ecstasy = createImg('https://mooo0ooo.github.io/diary/rose.PNG', 'Ecstasy').mousePressed(() => { handleEmotionButton('Ecstasy'); });
      buttons.adoration = createImg('https://mooo0ooo.github.io/diary/tulip.PNG', 'Adoration').mousePressed(() => { handleEmotionButton('Adoration'); });
      buttons.terror = createImg('https://mooo0ooo.github.io/diary/yellowFlower.PNG', 'Terror').mousePressed(() => { handleEmotionButton('Terror'); });
      buttons.amazement = createImg('https://mooo0ooo.github.io/diary/clover.PNG', 'Amazement').mousePressed(() => { handleEmotionButton('Amazement'); });
      buttons.grief = createImg('https://mooo0ooo.github.io/diary/futaba.PNG', 'Grief').mousePressed(() => { handleEmotionButton('Grief'); });
      buttons.loathing = createImg('https://mooo0ooo.github.io/diary/mizuiroFlower.PNG', 'Loathing').mousePressed(() => { handleEmotionButton('Loathing'); });
      buttons.rage = createImg('https://mooo0ooo.github.io/diary/blueFlower.PNG', 'Rage').mousePressed(() => { handleEmotionButton('Rage'); });
      buttons.vigilance = createImg('https://mooo0ooo.github.io/diary/cherryBlossom.PNG', 'Vigilance').mousePressed(() => { handleEmotionButton('Vigilance'); });

      motifImages['Serenity'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/apple.PNG');  
    　motifImages['Acceptance'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/carrot.PNG'); 
      motifImages['Apprehension'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/egg.PNG');
      motifImages['Distraction'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/avocado.PNG');
      motifImages['Pensiveness'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/broccoli.PNG');
      motifImages['Boredom'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/turnip.PNG');
      motifImages['Annoyance'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/fork.PNG');
      motifImages['Interest'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/glove.PNG');


      // Checkボタンを作成
      buttons.check = createButton('Check').mousePressed(displayArtwork);

      // Downloadボタンを作成（初めは非表示）
      buttons.download = createButton('Download Image').mousePressed(downloadImage);
      buttons.download.hide();

      // ラベルの作成
      let labels = {};

      labels.joy = createDiv('Joy: 喜び').addClass('emotion-label');
      labels.trust = createDiv('Trust: 信頼').addClass('emotion-label');
      labels.fear = createDiv('Fear: 恐れ').addClass('emotion-label');
      labels.surprise = createDiv('Surprise: 驚き').addClass('emotion-label');
      labels.sadness = createDiv('Sadness: 悲しみ').addClass('emotion-label');
      labels.disgust = createDiv('Disgust: 嫌悪').addClass('emotion-label');
      labels.anger = createDiv('Anger: 怒り').addClass('emotion-label');
      labels.anticipation = createDiv('Anticipation: 予期').addClass('emotion-label');

      labels.ecstasy = createDiv('Ecstasy: 恍惚').addClass('emotion-label');
      labels.adoration = createDiv('Adoration: 敬愛').addClass('emotion-label');
      labels.terror = createDiv('Terror: 恐怖').addClass('emotion-label');
      labels.amazement = createDiv('Amazement: 驚嘆').addClass('emotion-label');
      labels.grief = createDiv('Grief: 悲嘆').addClass('emotion-label');
      labels.loathing = createDiv('Loathing: 強い嫌悪').addClass('emotion-label');
      labels.rage = createDiv('Rage: 激怒').addClass('emotion-label');
      labels.vigilance = createDiv('Vigilance: 警戒').addClass('emotion-label');

      // 新しい感情のラベルを作成
      labels.serenity = createDiv('Serenity: 平静').addClass('emotion-label');
      labels.acceptance = createDiv('Acceptance: 容認').addClass('emotion-label');
      labels.apprehension = createDiv('Apprehension: 不安').addClass('emotion-label');
      labels.distraction = createDiv('Distraction: 放心').addClass('emotion-label');
      labels.pensiveness = createDiv('Pensiveness: 哀愁').addClass('emotion-label');
      labels.boredom = createDiv('Boredom: うんざり').addClass('emotion-label');
      labels.annoyance = createDiv('Annoyance: いらだち').addClass('emotion-label');
      labels.interest = createDiv('Interest: 関心').addClass('emotion-label');

      positionButtons();  // ボタンの配置を実行
    }

    function positionButtons() {
      let centerX = windowWidth / 2;
      let centerY = windowHeight / 2;
  
      let outerRadius = min(windowWidth, windowHeight) * 0.35; // 外側の円の半径
      let innerRadius = min(windowWidth, windowHeight) * 0.2;  // 内側の円の半径
      let buttonSize = min(windowWidth, windowHeight) * 0.08; // ボタンのサイズ

      let outerEmotions = ['joy', 'trust', 'fear', 'surprise', 'sadness', 'disgust', 'anger', 'anticipation'];
      let innerEmotions = ['ecstasy', 'adoration', 'terror', 'amazement', 'grief', 'loathing', 'rage', 'vigilance'];

      // 新しい感情のボタンを配置するための外側の円
      let extraRadius = outerRadius * 1.5;  // 新しいボタンの配置に使う円の半径
      let extraEmotions = ['serenity', 'acceptance', 'apprehension', 'distraction', 'pensiveness', 'boredom', 'annoyance', 'interest'];

      let outerOffset = -PI / 2;  // Joyを上に配置するためのオフセット
      for (let i = 0; i < outerEmotions.length; i++) {
        let angle = TWO_PI / outerEmotions.length * i + outerOffset;
        let x = centerX + outerRadius * cos(angle) - buttonSize / 2;
        let y = centerY + outerRadius * sin(angle) - buttonSize / 2;
        buttons[outerEmotions[i]].position(x, y).size(buttonSize, buttonSize);
        labels[outerEmotions[i]].position(x, y + buttonSize + 5).size(buttonSize, 20);
      }

      let innerOffset = -PI / 2;
      for (let i = 0; i < innerEmotions.length; i++) {
        let angle = TWO_PI / innerEmotions.length * i + innerOffset;
        let x = centerX + innerRadius * cos(angle) - buttonSize / 2;
        let y = centerY + innerRadius * sin(angle) - buttonSize / 2;
        buttons[innerEmotions[i]].position(x, y).size(buttonSize, buttonSize);
        labels[innerEmotions[i]].position(x, y + buttonSize + 5).size(buttonSize, 20);
      }

      // 新しい感情のボタンをさらに外側に円形に配置
      for (let i = 0; i < extraEmotions.length; i++) {
        let angle = TWO_PI / extraEmotions.length * i + outerOffset;
        let x = centerX + extraRadius * cos(angle) - buttonSize / 2;
        let y = centerY + extraRadius * sin(angle) - buttonSize / 2;
        buttons[extraEmotions[i]].position(x, y).size(buttonSize, buttonSize);
        labels[extraEmotions[i]].position(x, y + buttonSize + 5).size(buttonSize, 20);
      }

        buttons.check.position(windowWidth - buttonSize - 20, windowHeight - buttonSize - 20).size(buttonSize, buttonSize);
    }

    // ウィンドウリサイズ時にキャンバスとボタンの位置を再設定
    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      positionButtons();  // ボタンの再配置
    }

    function handleEmotionButton(emotion) {
      // 感情のカウントを増加
      switch (emotion) {
        case 'Joy': countJoy++; break;
        case 'Trust': countTrust++; break;
        case 'Fear': countFear++; break;
        case 'Surprise': countSurprise++; break;
        case 'Sadness': countSadness++; break;
        case 'Disgust': countDisgust++; break;
        case 'Anger': countAnger++; break;
        case 'Anticipation': countAnticipation++; break;
        case 'Ecstasy': countEcstasy++; break;
        case 'Adoration': countAdoration++; break;
        case 'Terror': countTerror++; break;
        case 'Amazement': countAmazement++; break;
        case 'Grief': countGrief++; break;
        case 'Loathing': countLoathing++; break;
        case 'Rage': countRage++; break;
        case 'Vigilance': countVigilance++; break;
        case 'Serenity': countSerenity++; break;
        case 'Acceptance': countAcceptance++; break;
        case 'Apprehension': countApprehension++; break;
        case 'Distraction': countDistraction++; break;
        case 'Pensiveness': countPensiveness++; break;
        case 'Boredom': countBoredom++; break;
        case 'Annoyance': countAnnoyance++; break;
        case 'Interest': countInterest++; break;
      }

      // キラキラを生成
      createSparkles(emotion);
    }

    function displayArtwork() {
      console.log("Display Artwork called");
      let totalGroup1 = countJoy + countTrust + countSurprise + countAnticipation + countSerenity + countAcceptance + countInterest; // Group 1: +
      let totalGroup2 = countFear + countSadness + countDisgust + countAnger + countApprehension + countDistraction + countPensiveness + countBoredom + countAnnoyance; // Group 2: -

      // 背景の決定
      let ratio = totalGroup1 / (totalGroup1 + totalGroup2);  // Group 1 と Group 2 の比率
      if (ratio >= 1) {
        selectedBackground = backgroundImages[0];  // 10:0 の比率
      } else if (ratio >= 0.6) {
        selectedBackground = backgroundImages[1];  // 6:4 の比率
      } else if (ratio >= 0.4) {
        selectedBackground = backgroundImages[2];  // 4:6 の比率
      } else {
        selectedBackground = backgroundImages[3];  // 0:10 の比率
      }

      // モチーフの決定（最も多く押された感情）
      let maxCount = Math.max(
        countJoy, countTrust, countFear, countSurprise, countSadness, countDisgust, countAnger, countAnticipation,
        countEcstasy, countAdoration, countTerror, countAmazement, countGrief, countLoathing, countRage, countVigilance,
        countSerenity, countAcceptance, countApprehension, countDistraction, countPensiveness, countBoredom, countAnnoyance, countInterest
      );

      if (maxCount === countJoy) {
        selectedMotif = motifImages['Joy'];
      } else if (maxCount === countTrust) {
        selectedMotif = motifImages['Trust'];
      } else if (maxCount === countFear) {
        selectedMotif = motifImages['Fear'];
      } else if (maxCount === countSurprise) {
        selectedMotif = motifImages['Surprise'];
      } else if (maxCount === countSadness) {
        selectedMotif = motifImages['Sadness'];
      } else if (maxCount === countDisgust) {
        selectedMotif = motifImages['Disgust'];
      } else if (maxCount === countAnger) {
        selectedMotif = motifImages['Anger'];
      } else if (maxCount === countAnticipation) {
        selectedMotif = motifImages['Anticipation'];
      } else if (maxCount === countEcstasy) {
        selectedMotif = motifImages['Ecstasy'];
      } else if (maxCount === countAdoration) {
        selectedMotif = motifImages['Adoration'];
      } else if (maxCount === countTerror) {
        selectedMotif = motifImages['Terror'];
      } else if (maxCount === countAmazement) {
        selectedMotif = motifImages['Amazement'];
      } else if (maxCount === countGrief) {
        selectedMotif = motifImages['Grief'];
      } else if (maxCount === countLoathing) {
        selectedMotif = motifImages['Loathing'];
      } else if (maxCount === countRage) {
        selectedMotif = motifImages['Rage'];
      } else if (maxCount === countVigilance) {
        selectedMotif = motifImages['Vigilance'];
      } else if (maxCount === countSerenity) {
        selectedMotif = motifImages['Serenity'];
      } else if (maxCount === countAcceptance) {
        selectedMotif = motifImages['Acceptance'];
      } else if (maxCount === countApprehension) {
        selectedMotif = motifImages['Apprehension'];
      } else if (maxCount === countDistraction) {
        selectedMotif = motifImages['Distraction'];
      } else if (maxCount === countPensiveness) {
        selectedMotif = motifImages['Pensiveness'];
      } else if (maxCount === countBoredom) {
        selectedMotif = motifImages['Boredom'];
      } else if (maxCount === countAnnoyance) {
        selectedMotif = motifImages['Annoyance'];
      } else if (maxCount === countInterest) {
        selectedMotif = motifImages['Interest'];
      }

      console.log("Selected Background:", selectedBackground);
      console.log("Selected Motif", selectedMotif);

      // ボタンを隠す
      hideButtons();
      drawArtwork();
    }

    function hideButtons() {
      // すべてのボタンを非表示に
      for (let key in buttons) {
        buttons[key].hide();
      }
    }

    function drawArtwork() {
      background(255);

      // 背景をスクエアとして表示
      if (selectedBackground) {
        let backgroundSize = min(width, height) * 0.8;  // 背景のサイズを画面に合わせて調整
        let padding = 20;  // 枠と背景の間のスペース

        // 背景画像を中央に表示
        image(selectedBackground, (width - backgroundSize) / 2, (height - backgroundSize) / 2, backgroundSize, backgroundSize);
      } else {
        console.log("Background image not available");
      }

      // モチーフの描画
      if (selectedMotif) {
        let motifSize = min(width, height) * 0.6;  // モチーフのサイズを調整
        tint(255, 250);  // 透過
        image(selectedMotif, (width - motifSize) / 2, (height - motifSize) / 2, motifSize, motifSize);
        noTint();  // 描画後に透過をリセット
      } else {
        console.log("Motif image not available");
      }

      // Downloadボタンを表示
      buttons.download.show();
    }

    function downloadImage() {
      // キャンバスを保存
      saveCanvas('artwork', 'png'); // 'artwork' という名前でPNG形式で保存
    }
  </script>
</body>
</html>


