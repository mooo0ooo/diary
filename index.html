<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <title>p5.js Responsive Example</title>
  <style>
    img {
      display: block;
      position: absolute;
    }
    .emotion-label {
      text-align: center;
      color: black;
      font-size: 16px;  
      position: relative;
      display: block;
    }
    #download-btn {
      display: none;
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;  /* ボタン間の隙間 */
    }

    button, label {
      flex-basis: calc(25% - 10px); /* 4列分のボタン */
      text-align: center;
    }

    @media (max-width: 800px) {
      button, label {
        flex-basis: calc(33.33% - 10px); /* 3列分のボタン */
      }
    }

    @media (max-width: 600px) {
      button, label {
        flex-basis: calc(50% - 10px); /* 2列分のボタン */
      }
    }

    label {
      text-align: center;  /* ラベルのテキストを中央揃え */
      width: auto;  /* ラベルの幅を自動調整 */
      display: block;
    }

  </style>
</head>
<body>
  <button id="download-btn">画像をダウンロード</button>
  <script>
    let backgroundImages = [];
    let motifImages = [];
    let emotionsA = ['Joy', 'Trust', 'Fear', 'Surprise', 'Sadness', 'Disgust', 'Anger', 'Anticipation'];
    let emotionsB = ['Ecstasy', 'Adoration', 'Terror', 'Amazement', 'Grief', 'Loathing', 'Rage', 'Vigilance'];
    let emotionsC = ['Serenity', 'Acceptance', 'Apprehension', 'Distraction', 'Pensiveness', 'Boredom', 'Annoyance', 'Interest'];
    let selectedEmotions = {};
    let selectedMotif = [];
    let positiveCount = 0;
    let negativeCount = 0;
    let backgroundChoice = 0;
    let motifChoice = '';
    let buttons = {};
    let labels = {};
    let checkButton;
    let isResultDisplayed = false;
    let emotionSize = 80;
    let windowWidth = window.innerWidth;

    function preload() {
      // 背景画像やモチーフ画像の読み込み
      backgroundImages[0] = loadImage('https://mooo0ooo.github.io/diary/background1.png');
      backgroundImages[1] = loadImage('https://mooo0ooo.github.io/diary/background2.png');
      backgroundImages[2] = loadImage('https://mooo0ooo.github.io/diary/background3.png');
      backgroundImages[3] = loadImage('https://mooo0ooo.github.io/diary/background4.png');

      motifImages['Joy'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/fireworks-removebg-preview.png');
      motifImages['Trust'] = loadImage('https://mooo0ooo.github.io/diary/sun-removebg-preview.png');
      motifImages['Fear'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/moon-removebg-preview.png');
      motifImages['Surprise'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/thunder.PNG');
      motifImages['Sadness'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/shooting_star-removebg-preview.png');
      motifImages['Disgust'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/rain.PNG');
      motifImages['Anger'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/star-removebg-preview.png');
      motifImages['Anticipation'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/balloon.PNG');
      motifImages['Ecstasy'] = loadImage('https://mooo0ooo.github.io/diary/rose.PNG');
      motifImages['Adoration'] = loadImage('https://mooo0ooo.github.io/diary/tulip.PNG');
      motifImages['Terror'] = loadImage('https://mooo0ooo.github.io/diary/yellowFlower.PNG');
      motifImages['Amazement'] = loadImage('https://mooo0ooo.github.io/diary/clover.PNG');
      motifImages['Grief'] = loadImage('https://mooo0ooo.github.io/diary/futaba.PNG');
      motifImages['Loathing'] = loadImage('https://mooo0ooo.github.io/diary/mizuiroFlower.PNG');
      motifImages['Rage'] = loadImage('https://mooo0ooo.github.io/diary/blueFlower.PNG');
      motifImages['Vigilance'] = loadImage('https://mooo0ooo.github.io/diary/cherryBlossom.PNG');
      motifImages['Serenity'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/apple.PNG');
      motifImages['Acceptance'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/carrot.PNG');
      motifImages['Apprehension'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/egg.PNG');
      motifImages['Distraction'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/avocado.PNG');
      motifImages['Pensiveness'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/broccoli.PNG');
      motifImages['Boredom'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/turnip.PNG');
      motifImages['Annoyance'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/fork.PNG');
      motifImages['Interest'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/glove.PNG');
    }

    function setup() {
      createCanvas(windowWidth, windowHeight);
      createEmotionButtons();

      checkButton = createButton('Check');
      checkButton.position(windowWidth / 2 - 50, windowHeight - 100);
      checkButton.mousePressed(displayResult);
    }

    function draw() {
      if (isResultDisplayed) return;
      background(255);
      clear();

      drawEmotionGrid(emotionsA, 0);
      drawEmotionGrid(emotionsB, 1);
      drawEmotionGrid(emotionsC, 2);

      checkButton.position(windowWidth / 2 - 50, windowHeight - 100);
    }

    window.addEventListener('resize', function() {
      windowWidth = window.innerWidth;
      drawEmotionGrid(emotionsA, 0);
      drawEmotionGrid(emotionsB, 1);
      drawEmotionGrid(emotionsC, 2);
    });

    function getColCount() {
      if (windowWidth > 1200) {
        emotionSize = 80;
        return 8;
      } else if (windowWidth > 800) {
        emotionSize = 70;
        return 6;
      } else if (windowWidth > 600) {
        emotionSize = 60;
        return 4;
      } else {
        emotionSize = 50;
        return 2;
      }
    }

    function drawEmotionGrid(emotions, row) {
      let colCount = getColCount();
      let xOffset = 20;
      let yOffset = 120;
      let rowWidth = colCount * (emotionSize + xOffset) - xOffset;
      let startX = (windowWidth - rowWidth) / 2;

            for (let i = 0; i < emotions.length; i++) {
        let x = startX + (i % colCount) * (emotionSize + xOffset);
        let y = row * (emotionSize + yOffset) + yOffset;

        buttons[emotions[i]].position(x, y);  // ボタンの位置を更新
        labels[emotions[i]].position(x + emotionSize / 2 - labels[emotions[i]].width / 2, y + emotionSize + 5);  // ラベルを中央揃え
      }
    }

    function createEmotionButtons() {
      buttons['Joy'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/fireworks-removebg-preview.png', 'Joy').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Joy'));
      labels['Joy'] = createDiv('Joy').addClass('emotion-label');

      buttons['Trust'] = createImg('https://mooo0ooo.github.io/diary/sun-removebg-preview.png', 'Trust').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Trust'));
      labels['Trust'] = createDiv('Trust').addClass('emotion-label');

      buttons['Fear'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/moon-removebg-preview.png', 'Fear').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Fear'));
      labels['Fear'] = createDiv('Fear').addClass('emotion-label');

      buttons['Surprise'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/thunder.PNG', 'Surprise').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Surprise'));
      labels['Surprise'] = createDiv('Surprise').addClass('emotion-label');

      buttons['Sadness'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/shooting_star-removebg-preview.png', 'Sadness').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Sadness'));
      labels['Sadness'] = createDiv('Sadness').addClass('emotion-label');

      buttons['Disgust'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/rain.PNG', 'Disgust').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Disgust'));
      labels['Disgust'] = createDiv('Disgust').addClass('emotion-label');

      buttons['Anger'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/star-removebg-preview.png', 'Anger').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Anger'));
      labels['Anger'] = createDiv('Anger').addClass('emotion-label');

      buttons['Anticipation'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/balloon.PNG', 'Anticipation').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Anticipation'));
      labels['Anticipation'] = createDiv('Anticipation').addClass('emotion-label');

      // 省略: 他のボタンのセットアップも同様に追加
    }

    function handleEmotionButton(emotion) {
      if (!selectedEmotions[emotion]) {
        selectedEmotions[emotion] = 0;
      }
      selectedEmotions[emotion]++;
      selectedMotif.push(motifImages[emotion]);

      let positiveEmotions = ['Joy', 'Trust', 'Surprise', 'Anticipation', 'Ecstasy', 'Adoration', 'Amazement', 'Vigilance', 'Serenity', 'Acceptance', 'Interest'];
      let negativeEmotions = ['Fear', 'Sadness', 'Disgust', 'Anger', 'Terror', 'Grief', 'Loathing', 'Rage', 'Apprehension', 'Pensiveness', 'Boredom', 'Annoyance'];

      if (positiveEmotions.includes(emotion)) {
        positiveCount++;
      } else {
        negativeCount++;
      }
    }

    function displayResult() {
      let totalCount = positiveCount + negativeCount;
      let positiveRatio = totalCount > 0 ? positiveCount / totalCount : 0;

      if (positiveRatio === 1) {
        backgroundChoice = 0;
      } else if (positiveRatio >= 0.6) {
        backgroundChoice = 1;
      } else if (positiveRatio >= 0.4) {
        backgroundChoice = 2;
      } else {
        backgroundChoice = 3;
      }

      clear();
      let img = backgroundImages[backgroundChoice];
      let imgAspect = img.width / img.height;
      let canvasAspect = width / height;

      let imgWidth, imgHeight;

      if (imgAspect > canvasAspect) {
        imgWidth = width;
        imgHeight = width / imgAspect;
      } else {
        imgHeight = height;
        imgWidth = height * imgAspect;
      }

      image(img, (width - imgWidth) / 2, (height - imgHeight) / 2, imgWidth, imgHeight);

      if (selectedMotif.length > 0) {
        for (let i = 0; i < selectedMotif.length; i++) {
          image(selectedMotif[i], width / 2 - selectedMotif[i].width / 2, height / 2 - selectedMotif[i].height / 2);
        }
      }

      let downloadBtn = select('#download-btn');
      downloadBtn.style('display', 'block');
      downloadBtn.mousePressed(() => saveCanvas('result', 'png'));

      isResultDisplayed = true;
    }

    function windowResized() {
      windowWidth = window.innerWidth;
      resizeCanvas(windowWidth, windowHeight);
      drawEmotionGrid(emotionsA, 0);
      drawEmotionGrid(emotionsB, 1);
      drawEmotionGrid(emotionsC, 2);
    }
  </script>
</body>
</html>

