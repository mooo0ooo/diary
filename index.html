<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <title>p5.js Responsive Example</title>
  <style>
    img {
      display: block;
      position: absolute;
    }
    .emotion-label {
      text-align: center;
      color: black;
      font-size: 10px;
    }
    #download-btn {
      display: none;
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <button id="download-btn">画像をダウンロード</button>
  <script>
    let backgroundImages = [];
    let motifImages = [];
    let emotionsA = ['joy', 'trust', 'fear', 'surprise', 'sadness', 'disgust', 'anger', 'anticipation'];
    let emotionsB = ['ecstasy', 'adoration', 'terror', 'amazement', 'grief', 'loathing', 'rage', 'vigilance'];
    let emotionsC = ['serenity', 'acceptance', 'apprehension', 'distraction', 'pensiveness', 'boredom', 'annoyance', 'interest'];
    let positiveEmotions = ['joy', 'trust', 'surprise', 'anticipation', 'ecstasy', 'adoration', 'amazement', 'serenity', 'acceptance', 'interest'];
    let negativeEmotions = ['fear', 'sadness', 'disgust', 'anger', 'terror', 'grief', 'loathing', 'rage', 'vigilance', 'apprehension', 'distraction', 'pensiveness', 'boredom', 'annoyance'];
    let selectedEmotions = {};  // 各感情の選択回数を保存するオブジェクト
    let selectedMotif = []; // 押されたモチーフを保存する配列
    let positiveCount = 0;
    let negativeCount = 0;
    let backgroundChoice = 0;
    let motifChoice = '';
    let radiusA, radiusB, radiusC;
    let emotionSize;
    let buttons = {};  // 感情ボタンのオブジェクト
    let labels = {};   // 感情名ラベルのオブジェクト
    let checkButton;   // 中央のCheckボタン
    let isResultDisplayed = false;  // 結果表示状態を管理

    function preload() {
      // 背景画像やモチーフ画像の読み込み
      backgroundImages[0] = loadImage('https://mooo0ooo.github.io/diary/background1.png');
      backgroundImages[1] = loadImage('https://mooo0ooo.github.io/diary/background2.png');
      backgroundImages[2] = loadImage('https://mooo0ooo.github.io/diary/background3.png');
      backgroundImages[3] = loadImage('https://mooo0ooo.github.io/diary/background4.png');

      motifImages['joy'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/fireworks-removebg-preview.png');
      motifImages['trust'] = loadImage('https://mooo0ooo.github.io/diary/sun-removebg-preview.png');
      motifImages['fear'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/moon-removebg-preview.png');
      motifImages['surprise'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/thunder.PNG');
      motifImages['sdness'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/shooting_star-removebg-preview.png');
      motifImages['disgust'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/rain.PNG');
      motifImages['anger'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/star-removebg-preview.png');
      motifImages['anticipation'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/balloon.PNG');
      motifImages['ecstasy'] = loadImage('https://mooo0ooo.github.io/diary/rose.PNG');
      motifImages['adoration'] = loadImage('https://mooo0ooo.github.io/diary/tulip.PNG');
      motifImages['trerror'] = loadImage('https://mooo0ooo.github.io/diary/yellowFlower.PNG');
      motifImages['amazement'] = loadImage('https://mooo0ooo.github.io/diary/clover.PNG');
      motifImages['grief'] = loadImage('https://mooo0ooo.github.io/diary/futaba.PNG');
      motifImages['loathing'] = loadImage('https://mooo0ooo.github.io/diary/mizuiroFlower.PNG');
      motifImages['rage'] = loadImage('https://mooo0ooo.github.io/diary/blueFlower.PNG');
      motifImages['vigilance'] = loadImage('https://mooo0ooo.github.io/diary/cherryBlossom.PNG');
      motifImages['serenity'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/apple.PNG');
      motifImages['acceptance'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/carrot.PNG');
      motifImages['apprehension'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/egg.PNG');
      motifImages['distraction'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/avocado.PNG');
      motifImages['pensiveness'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/broccoli.PNG');
      motifImages['boredom'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/turnip.PNG');
      motifImages['annoyance'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/fork.PNG');
      motifImages['interest'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/glove.PNG');
    }

    function setup() {
      createCanvas(windowWidth, windowHeight);
      calculateSizes();
      createEmotionButtons();

      // 中央にCheckボタンを作成
      checkButton = createButton('Check');
      checkButton.position(windowWidth / 2 - 50, windowHeight / 2 - 20);
      checkButton.mousePressed(displayResult);
    }

    function draw() {
      if (isResultDisplayed) {
        return; // 結果が表示された後はdraw()で何もしない
      }
      
      clear();
      background(255); // 白背景
      translate(width / 2, height / 2);

      drawEmotionCircle(emotionsA, radiusA);
      drawEmotionCircle(emotionsB, radiusB);
      drawEmotionCircle(emotionsC, radiusC);

      checkButton.position(windowWidth / 2 - 50, windowHeight / 2 - 20);
    }

    function drawEmotionCircle(emotions, radius) {
      let angleStep = TWO_PI / emotions.length;

      for (let i = 0; i < emotions.length; i++) {
        let angle = i * angleStep;
        let x = cos(angle) * radius;
        let y = sin(angle) * radius;

        buttons[emotions[i]].position(width / 2 + x - emotionSize / 2, height / 2 + y - emotionSize / 2);
        labels[emotions[i]].position(width / 2 + x - emotionSize / 2, height / 2 + y + emotionSize / 2);
      }
    }

    function createEmotionButtons() {
      buttons['joy'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/fireworks-removebg-preview.png').mousePressed(() => handleEmotionButton('Joy'));
      labels['joy'] = createDiv('Joy').addClass('emotion-label');

      buttons['trust'] = createImg('https://mooo0ooo.github.io/diary/sun-removebg-preview.png').mousePressed(() => handleEmotionButton('Trust'));
      labels['trust'] = createDiv('Trust').addClass('emotion-label');

      buttons['fear'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/moon-removebg-preview.png').mousePressed(() => handleEmotionButton('Fear'));
      labels['fear'] = createDiv('Fear').addClass('emotion-label');

      buttons['surprise'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/thunder.PNG').mousePressed(() => handleEmotionButton('Surprise'));
      labels['surprise'] = createDiv('Surprise').addClass('emotion-label');

      buttons['sadness'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/shooting_star-removebg-preview.png').mousePressed(() => handleEmotionButton('Sadness'));
      labels['sadness'] = createDiv('Sadness').addClass('emotion-label');

      buttons['disgust'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/rain.PNG').mousePressed(() => handleEmotionButton('Disgust'));
      labels['disgust'] = createDiv('Disgust').addClass('emotion-label');

      buttons['anger'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/star-removebg-preview.png').mousePressed(() => handleEmotionButton('Anger'));
      labels['anger'] = createDiv('Anger').addClass('emotion-label');

      buttons['anticipation'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/balloon.PNG').mousePressed(() => handleEmotionButton('Anticipation'));
      labels['anticipation'] = createDiv('Anticipation').addClass('emotion-label');

      buttons['ecstasy'] = createImg('https://mooo0ooo.github.io/diary/rose.PNG').mousePressed(() => handleEmotionButton('Ecstasy'));
      labels['ecstasy'] = createDiv('Ecstasy').addClass('emotion-label');

      buttons['adoration'] = createImg('https://mooo0ooo.github.io/diary/tulip.PNG').mousePressed(() => handleEmotionButton('Adoration'));
      labels['adoration'] = createDiv('Adoration').addClass('emotion-label');

      buttons['terror'] = createImg('https://mooo0ooo.github.io/diary/yellowFlower.PNG').mousePressed(() => handleEmotionButton('Terror'));
      labels['terror'] = createDiv('Terror').addClass('emotion-label');

      buttons['amazement'] = createImg('https://mooo0ooo.github.io/diary/clover.PNG').mousePressed(() => handleEmotionButton('Amazement'));
      labels['amazement'] = createDiv('Amazement').addClass('emotion-label');

      buttons['grief'] = createImg('https://mooo0ooo.github.io/diary/futaba.PNG').mousePressed(() => handleEmotionButton('Grief'));
      labels['grief'] = createDiv('Grief').addClass('emotion-label');

      buttons['loathing'] = createImg('https://mooo0ooo.github.io/diary/mizuiroFlower.PNG').mousePressed(() => handleEmotionButton('Loathing'));
      labels['loathing'] = createDiv('Loathing').addClass('emotion-label');

      buttons['rage'] = createImg('https://mooo0ooo.github.io/diary/blueFlower.PNG').mousePressed(() => handleEmotionButton('Rage'));
      labels['rage'] = createDiv('Rage').addClass('emotion-label');

      buttons['vigilance'] = createImg('https://mooo0ooo.github.io/diary/cherryBlossom.PNG').mousePressed(() => handleEmotionButton('Vigilance'));
      labels['vigilance'] = createDiv('Vigilance').addClass('emotion-label');

      buttons['serenity'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/apple.PNG').mousePressed(() => handleEmotionButton('Serenity'));
      labels['serenity'] = createDiv('Serenity').addClass('emotion-label');

      buttons['acceptance'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/carrot.PNG').mousePressed(() => handleEmotionButton('Acceptance'));
      labels['acceptance'] = createDiv('Acceptance').addClass('emotion-label');

      buttons['apprehension'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/egg.PNG').mousePressed(() => handleEmotionButton('Apprehension'));
      labels['apprehension'] = createDiv('Apprehension').addClass('emotion-label');

      buttons['distraction'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/avocado.PNG').mousePressed(() => handleEmotionButton('Distraction'));
      labels['distraction'] = createDiv('Distraction').addClass('emotion-label');

      buttons['pensiveness'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/broccoli.PNG').mousePressed(() => handleEmotionButton('Pensiveness'));
      labels['pensiveness'] = createDiv('Pensiveness').addClass('emotion-label');

      buttons['boredom'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/turnip.PNG').mousePressed(() => handleEmotionButton('Boredom'));
      labels['boredom'] = createDiv('Boredom').addClass('emotion-label');

      buttons['annoyance'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/fork.PNG').mousePressed(() => handleEmotionButton('Annoyance'));
      labels['annoyance'] = createDiv('Annoyance').addClass('emotion-label');

      buttons['interest'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/glove.PNG').mousePressed(() => handleEmotionButton('Interest'));
      labels['interest'] = createDiv('Interest').addClass('emotion-label');
    }

    unction handleEmotionButton(emotion, motif) {
      if (!selectedEmotions[emotion]) {
        selectedEmotions[emotion] = 0;
      }
      selectedEmotions[emotion]++;
      selectedMotif.push(motif);

      if (positiveEmotions.includes(emotion)) {
        positiveCount++;
      } else if (negativeEmotions.includes(emotion)) {
        negativeCount++;
      }
      console.log(`${emotion} ボタンが押されました`);
    }

    function displayResult() {
      // ポジティブとネガティブの比率から背景を決定
      let totalCount = positiveCount + negativeCount;
      let positiveRatio = totalCount > 0 ? positiveCount / totalCount : 0;

      if (positiveRatio === 1) {
        backgroundChoice = 0;
      } else if (positiveRatio >= 0.6) {
        backgroundChoice = 1;
      } else if (positiveRatio >= 0.4) {
        backgroundChoice = 2;
      } else {
        backgroundChoice = 3;
      }

      // 最も多く押されたモチーフを決定
      let motifCounts = selectedMotif.reduce((acc, motif) => {
        acc[motif] = (acc[motif] || 0) + 1;
        return acc;
      }, {});

      motifChoice = Object.keys(motifCounts).reduce((a, b) => motifCounts[a] > motifCounts[b] ? a : b);

      // 画面をクリアして結果を表示
      clear();
      background(backgroundImages[backgroundChoice]);
      image(motifImages[motifChoice], width / 2 - motifImages[motifChoice].width / 2, height / 2 - motifImages[motifChoice].height / 2);

      // ダウンロードボタンを表示
      let downloadBtn = select('#download-btn');
      downloadBtn.show();
      downloadBtn.mousePressed(() => saveCanvas('result', 'png'));

      isResultDisplayed = true;
    }

    function calculateSizes() {
      // デバイスに基づくサイズ調整
      let smallestDimension = min(windowWidth, windowHeight);
      radiusA = smallestDimension / 3;  // 内側の円
      radiusB = rediusA * 0.75;   // 中間の円
      radiusC = redius * 0.75;  // 外側の円
      emotionSize = smallestDimension / 12; // ボタンのサイズを決定
    }

    function windowResized() {
      // ウィンドウサイズが変更された際にキャンバスとサイズを調整
      resizeCanvas(windowWidth, windowHeight);
      calculateSizes();
    }
  </script>
</body>
</html>
