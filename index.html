<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <title>p5.js Responsive Example</title>
  <style>
    img {
      display: block;
      position: absolute;
    }
  </style>
</head>
<body>
  <script>
    let backgroundImages = [];
    let motifImages = [];
    let countJoy = 0, countTrust = 0, countFear = 0, countSurprise = 0, countSadness = 0, countDisgust = 0, countAnger = 0, countAnticipation = 0;
    let selectedBackground, selectedMotif;

    let buttons = {};
    let sparkles = [];
    let sparkleDuration = 2000; // キラキラの表示時間
    let sparkleColors = {
      'Joy': '#B50000',
      'Trust': '#E58351',
      'Fear': '#FFD036',
      'Surprise': '#36C238',
      'Sadness': '#008704',
      'Disgust': '#5D94A6',
      'Anger': '#00699D',
      'Anticipation': '#FF7CC0'
    };

    function preload() {
      // 背景画像の読み込み
      backgroundImages[0] = loadImage('https://mooo0ooo.github.io/diary/background1.png');
      backgroundImages[1] = loadImage('https://mooo0ooo.github.io/diary/background2.png');
      backgroundImages[2] = loadImage('https://mooo0ooo.github.io/diary/background3.png');
      backgroundImages[3] = loadImage('https://mooo0ooo.github.io/diary/background4.png');

      // モチーフ画像の読み込み
      motifImages['Joy'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/fireworks-removebg-preview.png');
      motifImages['Trust'] = loadImage('https://mooo0ooo.github.io/diary/sun-removebg-preview.png'); // タイポを修正
      motifImages['Fear'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/moon-removebg-preview.png');
      motifImages['Surprise'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/thunder.PNG');
      motifImages['Sadness'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/shooting_star-removebg-preview.png');
      motifImages['Disgust'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/rain.PNG');
      motifImages['Anger'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/star-removebg-preview.png');
      motifImages['Anticipation'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/balloon.PNG');
    }

    function setup() {
      createCanvas(windowWidth, windowHeight);
      background(255);

      // 感情のボタンを画像として作成
      buttons.joy = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/fireworks-removebg-preview.png', 'Joy').mousePressed(() => { handleEmotionButton('Joy'); });
      buttons.trust = createImg('https://mooo0ooo.github.io/diary/sun-removebg-preview.png', 'Trust').mousePressed(() => { handleEmotionButton('Trust'); });
      buttons.fear = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/moon-removebg-preview.png', 'Fear').mousePressed(() => { handleEmotionButton('Fear'); });
      buttons.surprise = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/thunder.PNG', 'Surprise').mousePressed(() => { handleEmotionButton('Surprise'); });
      buttons.sadness = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/shooting_star-removebg-preview.png', 'Sadness').mousePressed(() => { handleEmotionButton('Sadness'); });
      buttons.disgust = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/rain.PNG', 'Disgust').mousePressed(() => { handleEmotionButton('Disgust'); });
      buttons.anger = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/star-removebg-preview.png', 'Anger').mousePressed(() => { handleEmotionButton('Anger'); });
      buttons.anticipation = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/balloon.PNG', 'Anticipation').mousePressed(() => { handleEmotionButton('Anticipation'); });

      // Checkボタンを作成
      buttons.check = createButton('Check').mousePressed(displayArtwork);

      // Downloadボタンを作成（初めは非表示）
      buttons.download = createButton('Download Image').mousePressed(downloadImage);
      buttons.download.hide();

      positionButtons();  // ボタンの配置を実行
    }

    function handleEmotionButton(emotion) {
      // 感情のカウントを増加
      switch (emotion) {
        case 'Joy': countJoy++; break;
        case 'Trust': countTrust++; break;
        case 'Fear': countFear++; break;
        case 'Surprise': countSurprise++; break;
        case 'Sadness': countSadness++; break;
        case 'Disgust': countDisgust++; break;
        case 'Anger': countAnger++; break;
        case 'Anticipation': countAnticipation++; break;
      }

      // キラキラを生成
      createSparkles(emotion);
    }

    function createSparkles(emotion) {
      let numSparkles = 20; // キラキラの数

      sparkles = [];

      for (let i = 0; i < numSparkles; i++) {
        let x = random(width);
        let y = random(height);
        let size = random(1, 3);

        sparkles.push({
          x: x,
          y: y,
          size: size,
          color: sparkleColors[emotion], // 修正
          outlineColor: sparkleColors[emotion], // 修正
          shape: random(['circle', 'star', 'hexagon', 'diamond']), // 形をランダムに
          alpha: 255
        });
      }

      // 2秒後に消える
      setTimeout(() => {
        sparkles = []; // キラキラを消去
      }, sparkleDuration);
    }

    function draw() {
      background(255);
      drawSparkles();
    }

    function drawSparkles() {
      for (let sparkle of sparkles) {
        fill(sparkle.color);
        stroke(sparkle.outlineColor);
        strokeWeight(2);
        noFill();

        switch (sparkle.shape) {
          case 'circle':
            ellipse(sparkle.x, sparkle.y, sparkle.size);
            break;
          case 'star':
            drawStar(sparkle.x, sparkle.y, sparkle.size, sparkle.size * 1.5, 5); // 星の描画
            break;
          case 'hexagon':
            drawPolygon(sparkle.x, sparkle.y, sparkle.size, 6); // 六角形の描画
            break;
          case 'diamond':
            drawPolygon(sparkle.x, sparkle.y, sparkle.size, 4); // ダイヤの描画
            break;
        }
      }
    }

    // 星を描画する関数
    function drawStar(x, y, radius1, radius2, npoints) {
      let angle = TWO_PI / npoints;
      let halfAngle = angle / 2.0;
      beginShape();
      for (let a = 0; a < TWO_PI; a += angle) {
        let sx = x + cos(a) * radius2;
        let sy = y + sin(a) * radius2;
        vertex(sx, sy);
        sx = x + cos(a + halfAngle) * radius1;
        sy = y + sin(a + halfAngle) * radius1;
        vertex(sx, sy);
      }
            endShape(CLOSE);
    }

    // 多角形を描画する関数
    function drawPolygon(x, y, radius, npoints) {
      let angle = TWO_PI / npoints;
      beginShape();
      for (let a = 0; a < TWO_PI; a += angle) {
        let sx = x + cos(a) * radius;
        let sy = y + sin(a) * radius;
        vertex(sx, sy);
      }
      endShape(CLOSE);
    }

    // ボタンを円形に配置する関数
    function positionButtons() {
      let centerX = windowWidth / 2;
      let centerY = windowHeight / 2;
      let radius = min(windowWidth, windowHeight) * 0.3; // 円の半径
      let buttonSize = min(windowWidth, windowHeight) * 0.1; // ボタンのサイズ
      let emotions = ['joy', 'trust', 'fear', 'surprise', 'sadness', 'disgust', 'anger', 'anticipation'];
      let offset = -PI / 4;
      
      // 角度を使って円形に配置
      for (let i = 0; i < emotions.length; i++) {
        let angle = TWO_PI / emotions.length * i + offset;
        let x = centerX + radius * cos(angle) - buttonSize / 2;
        let y = centerY + radius * sin(angle) - buttonSize / 2;
        buttons[emotions[i]].position(x, y).size(buttonSize, buttonSize);
      }

      // Checkボタンを画面の右下に配置
      buttons.check.position(windowWidth - buttonSize - 20, windowHeight - buttonSize - 20).size(buttonSize, buttonSize);
      buttons.download.position(windowWidth - buttonSize - 20, windowHeight - (buttonSize * 2) - 40).size(buttonSize, buttonSize);
    }

    // ウィンドウリサイズ時にキャンバスとボタンの位置を再設定
    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      positionButtons();  // ボタンの再配置
    }

    function displayArtwork() {

      console.log("Display Artwork called");
      let totalGroup1 = countJoy + countTrust + countSurprise + countAnticipation; // Group 1: +
      let totalGroup2 = countFear + countSadness + countDisgust + countAnger; // Group 2: -

      // 背景の決定
      let ratio = totalGroup1 / (totalGroup1 + totalGroup2);  // Group 1 と Group 2 の比率
      if (ratio >= 1) {
        selectedBackground = backgroundImages[0];  // 10:0 の比率
      } else if (ratio >= 0.6) {
        selectedBackground = backgroundImages[1];  // 6:4 の比率
      } else if (ratio >= 0.4) {
        selectedBackground = backgroundImages[2];  // 4:6 の比率
      } else {
        selectedBackground = backgroundImages[3];  // 0:10 の比率
      }

      // モチーフの決定（最も多く押された感情）
      let maxCount = Math.max(countJoy, countTrust, countFear, countSurprise, countSadness, countDisgust, countAnger, countAnticipation);
      if (maxCount === countJoy) {
        selectedMotif = motifImages['Joy'];
      } else if (maxCount === countTrust) {
        selectedMotif = motifImages['Trust'];
      } else if (maxCount === countFear) {
        selectedMotif = motifImages['Fear'];
      } else if (maxCount === countSurprise) {
        selectedMotif = motifImages['Surprise'];
      } else if (maxCount === countSadness) {
        selectedMotif = motifImages['Sadness'];
      } else if (maxCount === countDisgust) {
        selectedMotif = motifImages['Disgust'];
      } else if (maxCount === countAnger) {
        selectedMotif = motifImages['Anger'];
      } else if (maxCount === countAnticipation) {
        selectedMotif = motifImages['Anticipation'];
      }

      console.log("Selected Background:", selectedBackground);
      console.log("Selected Motif", selectedMotif);

      // ボタンを隠す
      hideButtons();
      drawArtwork();
    }

    function hideButtons() {
      // すべてのボタンを非表示に
      for (let key in buttons) {
        buttons[key].hide();
      }
    }

    function drawArtwork() {
      background(255);
      noLoop();

      console.log("Drawing background image");
image(selectedBackground, (width - backgroundSize) / 2, (height - backgroundSize) / 2, backgroundSize, backgroundSize);

      
      // 背景をスクエアとして表示
      if (selectedBackground) {
        let backgroundSize = min(width, height) * 0.8;  // 背景のサイズを画面に合わせて調整
        let padding = 20;  // 枠と背景の間のスペース

        // 背景画像を中央に表示
        console.log("Drawing background image");
        image(selectedBackground, (width - backgroundSize) / 2, (height - backgroundSize) / 2, backgroundSize, backgroundSize);
      } else {
        console.log("Background image not available");
      }

      console.log("Selected Background:", selectedBackground);

      // モチーフの描画
      if (selectedMotif) {
        let motifSize = min(width, height) * 0.6;  // モチーフのサイズを調整
        tint(255, 250);  // 透過
        image(selectedMotif, (width - motifSize) / 2, (height - motifSize) / 2, motifSize, motifSize);
        noTint();  // 描画後に透過をリセット
      } else {
        console.log("Motif image not available");
      }
    }

    function downloadImage() {
      // キャンバスを保存
      saveCanvas('artwork', 'png'); // 'artwork' という名前でPNG形式で保存
    }

  </script>
</body>
</html>

     
