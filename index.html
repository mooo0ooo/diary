<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <title>p5.js Responsive Example</title>
  <style>
    img {
      display: block;
      position: absolute;
    }
    .emotion-label {
      text-align: center;
      color: black;
      font-size: 12px;  
      position: absolute;
    }
    #download-btn {
      display: none;
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      background-color: white;
      color: black;
      border: 2px solid black;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <button id="download-btn">画像をダウンロード</button>
  <button id="language-btn" style="position: absolute; top: 50px; left: 50%; transform: translateX(-50%); padding: 10px 20px; background-color: #2196F3; color: white; border: none; cursor: pointer;">Japanese</button>
  
  <script>
    let backgroundImages = [];
    let motifImages = [];
    let emotionsA_en = ['Joy', 'Trust', 'Fear', 'Surprise', 'Sadness', 'Disgust', 'Anger', 'Anticipation'];
    let emotionsA_ja = ['喜び', '信頼', '恐れ', '驚き', '悲しみ', '嫌悪', '怒り', '期待＜予期＞'];
    let emotionsB_en = ['Ecstasy', 'Adoration', 'Terror', 'Amazement', 'Grief', 'Loathing', 'Rage', 'Vigilance'];
    let emotionsB_ja = ['恍惚', '敬愛', '恐怖', '驚嘆', '悲嘆', '強い嫌悪', '激怒', '警戒'];
    let emotionsC_en = ['Serenity', 'Acceptance', 'Apprehension', 'Distraction', 'Pensiveness', 'Boredom', 'Annoyance', 'Interest'];
    let emotionsC_ja = ['平穏', '容認', '不安', '放心', '哀愁', 'うんざり', '苛立ち', '関心'];

    let currentLanguage = 'en';
    let emotionsA = emotionsA_en;
    let emotionsB = emotionsB_en;
    let emotionsC = emotionsC_en;

    const emotionTranslationMap = {
      '喜び': 'Joy',
      '信頼': 'Trust',
      '恐れ': 'Fear',
      '驚き': 'Surprise',
      '悲しみ': 'Sadness',
      '嫌悪': 'Disgust',
      '怒り': 'Anger',
      '期待＜予期＞': 'Anticipation',
      '恍惚': 'Ecstasy',
      '敬愛': 'Adoration',
      '恐怖': 'Terror',
      '驚嘆': 'Amazement',
      '悲嘆': 'Grief',
      '強い嫌悪': 'Loathing',
      '激怒': 'Rage',
      '警戒': 'Vigilance',
      '平穏': 'Serenity',
      '容認': 'Acceptance',
      '不安': 'Apprehension',
      '放心': 'Distraction',
      '哀愁': 'Pensiveness',
      'うんざり': 'Boredom',
      '苛立ち': 'Annoyance',
      '関心': 'Interest'
    };

    let selectedEmotions = {};
    let selectedMotif = [];
    let positiveCount = 0;
    let negativeCount = 0;
    let backgroundChoice = 0;
    let motifChoice = '';
    let emotionSize = 80;
    let buttons = {};
    let labels = {};
    let checkButton;
    let isResultDisplayed = false;

    let effectShapes = [];
    let effectColor;
    let effectStartTime = 0;
    let isEffectActive = false;

    // 色の定義
    const emotionColors = {
      'Joy': '#B50000',
      'Trust': '#E58351',
      'Fear': '#FFD036',
      'Surprise': '#36C238',
      'Sadness': '#008704',
      'Disgust': '#5D94A6',
      'Anger': '#00699D',
      'Anticipation': '#FF7CC0',
      'Ecstasy': '#7F0000',
      'Adoration': '#B2653E',
      'Terror': '#CCA32A',
      'Amazement': '#003A00',
      'Grief': '#00496B',
      'Loathing': '#406672',
      'Rage': '#278E27',
      'Vigilance': '#CC6399',
      'Serenity': '#E50000',
      'Acceptance': '#FF7F3F',
      'Apprehension': '#FF8F00',
      'Distraction': '#00BA03',
      'Pensiveness': '#008ED1',
      'Boredom': '#7FCBE2',
      'Annoyance': '#B2E4B2',
      'Interest': '#FF7CC0'
    };
    
    function preload() {
      // 背景画像やモチーフ画像の読み込み
      backgroundImages[0] = loadImage('https://mooo0ooo.github.io/diary/background1.png');
      backgroundImages[1] = loadImage('https://mooo0ooo.github.io/diary/background2.png');
      backgroundImages[2] = loadImage('https://mooo0ooo.github.io/diary/background3.png');
      backgroundImages[3] = loadImage('https://mooo0ooo.github.io/diary/background4.png');

      motifImages['Joy'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/fireworks-removebg-preview.png');
      motifImages['Trust'] = loadImage('https://mooo0ooo.github.io/diary/sun-removebg-preview.png');
      motifImages['Fear'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/moon-removebg-preview.png');
      motifImages['Surprise'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/thunder.PNG');
      motifImages['Sadness'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/shooting_star-removebg-preview.png');
      motifImages['Disgust'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/rain.PNG');
      motifImages['Anger'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/star-removebg-preview.png');
      motifImages['Anticipation'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/balloon.PNG');
      motifImages['Ecstasy'] = loadImage('https://mooo0ooo.github.io/diary/rose.PNG');
      motifImages['Adoration'] = loadImage('https://mooo0ooo.github.io/diary/tulip.PNG');
      motifImages['Terror'] = loadImage('https://mooo0ooo.github.io/diary/yellowFlower.PNG');
      motifImages['Amazement'] = loadImage('https://mooo0ooo.github.io/diary/clover.PNG');
      motifImages['Grief'] = loadImage('https://mooo0ooo.github.io/diary/futaba.PNG');
      motifImages['Loathing'] = loadImage('https://mooo0ooo.github.io/diary/mizuiroFlower.PNG');
      motifImages['Rage'] = loadImage('https://mooo0ooo.github.io/diary/blueFlower.PNG');
      motifImages['Vigilance'] = loadImage('https://mooo0ooo.github.io/diary/cherryBlossom.PNG');
      motifImages['Serenity'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/apple.PNG');
      motifImages['Acceptance'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/carrot.PNG');
      motifImages['Apprehension'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/egg.PNG');
      motifImages['Distraction'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/avocado.PNG');
      motifImages['Pensiveness'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/broccoli.PNG');
      motifImages['Boredom'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/turnip.PNG');
      motifImages['Annoyance'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/fork.PNG');
      motifImages['Interest'] = loadImage('https://raw.githubusercontent.com/mooo0ooo/diary/main/glove.PNG');
    }

function setup() {
      createCanvas(windowWidth, windowHeight);
      createEmotionButtons();

      checkButton = createButton('Check');
      checkButton.position(windowWidth / 2 - 50, windowHeight - 100);
      checkButton.mousePressed(displayResult);

      select('#language-btn').mousePressed(toggleLanguage);
    }

 function draw() {
      if (isResultDisplayed) return;
      
      clear();
      drawEmotionGrid(emotionsA, 0);
      drawEmotionGrid(emotionsB, 1);
      drawEmotionGrid(emotionsC, 2);

      checkButton.position(windowWidth / 2 - 50, windowHeight - 100);

      if (isEffectActive) {
        drawEffects();
        if (millis() - effectStartTime > 2000) {
          isEffectActive = false;
        }
      }
    }

    function drawEmotionGrid(emotions, row) {
      let colCount = getColCount();
      let xOffset = 20;
      let yOffset = 120;
      let totalRowWidth = (colCount * emotionSize) + ((colCount - 1) * xOffset);
      let startX = (windowWidth - totalRowWidth) / 2;

      for (let i = 0; i < emotions.length; i++) {
        let x = startX + (i % colCount) * (emotionSize + xOffset);
        let y = row * (emotionSize + yOffset) + yOffset;

        buttons[emotions[i]].position(x, y);
        labels[emotions[i]].position(x + emotionSize / 2 - 20, y + emotionSize + 5);
      }
    }

    function getColCount() {
      if (windowWidth > 1200) return 8;
      if (windowWidth > 800) return 6;
      return 4;
    }

    function createEmotionButtons() {
      buttons['Joy'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/fireworks-removebg-preview.png', 'Joy').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Joy'));
      labels['Joy'] = createDiv('Joy').addClass('emotion-label');

      buttons['Trust'] = createImg('https://mooo0ooo.github.io/diary/sun-removebg-preview.png', 'Trust').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Trust'));
      labels['Trust'] = createDiv('Trust').addClass('emotion-label');

      buttons['Fear'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/moon-removebg-preview.png', 'Fear').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Fear'));
      labels['Fear'] = createDiv('Fear').addClass('emotion-label');

      buttons['Surprise'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/thunder.PNG', 'Surprise').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Surprise'));
      labels['Surprise'] = createDiv('Surprise').addClass('emotion-label');

      buttons['Sadness'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/shooting_star-removebg-preview.png', 'Sadness').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Sadness'));
      labels['Sadness'] = createDiv('Sadness').addClass('emotion-label');

      buttons['Disgust'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/rain.PNG', 'Disgust').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Disgust'));
      labels['Disgust'] = createDiv('Disgust').addClass('emotion-label');

      buttons['Anger'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/star-removebg-preview.png', 'Anger').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Anger'));
      labels['Anger'] = createDiv('Anger').addClass('emotion-label');

      buttons['Anticipation'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/balloon.PNG', 'Anticipation').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Anticipation'));
      labels['Anticipation'] = createDiv('Anticipation').addClass('emotion-label');

      buttons['Ecstasy'] = createImg('https://mooo0ooo.github.io/diary/rose.PNG', 'Ecstasy').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Ecstasy'));
      labels['Ecstasy'] = createDiv('Ecstasy').addClass('emotion-label');

      buttons['Adoration'] = createImg('https://mooo0ooo.github.io/diary/tulip.PNG', 'Adoration').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Adoration'));
      labels['Adoration'] = createDiv('Adoration').addClass('emotion-label');

      buttons['Terror'] = createImg('https://mooo0ooo.github.io/diary/yellowFlower.PNG', 'Terror').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Terror'));
      labels['Terror'] = createDiv('Terror').addClass('emotion-label');

      buttons['Amazement'] = createImg('https://mooo0ooo.github.io/diary/clover.PNG', 'Amazement').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Amazement'));
      labels['Amazement'] = createDiv('Amazement').addClass('emotion-label');

      buttons['Grief'] = createImg('https://mooo0ooo.github.io/diary/futaba.PNG', 'Grief').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Grief'));
      labels['Grief'] = createDiv('Grief').addClass('emotion-label');

      buttons['Loathing'] = createImg('https://mooo0ooo.github.io/diary/mizuiroFlower.PNG', 'Loathing').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Loathing'));
      labels['Loathing'] = createDiv('Loathing').addClass('emotion-label');

      buttons['Rage'] = createImg('https://mooo0ooo.github.io/diary/blueFlower.PNG', 'Rage').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Rage'));
      labels['Rage'] = createDiv('Rage').addClass('emotion-label');

      buttons['Vigilance'] = createImg('https://mooo0ooo.github.io/diary/cherryBlossom.PNG', 'Vigilance').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Vigilance'));
      labels['Vigilance'] = createDiv('Vigilance').addClass('emotion-label');

      buttons['Serenity'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/apple.PNG', 'Serenity').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Serenity'));
      labels['Serenity'] = createDiv('Serenity').addClass('emotion-label');

      buttons['Acceptance'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/carrot.PNG', 'Acceptance').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Acceptance'));
      labels['Acceptance'] = createDiv('Acceptance').addClass('emotion-label');

      buttons['Apprehension'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/egg.PNG', 'Apprehension').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Apprehension'));
      labels['Apprehension'] = createDiv('Apprehension').addClass('emotion-label');

      buttons['Distraction'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/avocado.PNG', 'Distraction').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Distraction'));
      labels['Distraction'] = createDiv('Distraction').addClass('emotion-label');

      buttons['Pensiveness'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/broccoli.PNG', 'Pensiveness').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Pensiveness'));
      labels['Pensiveness'] = createDiv('Pensiveness').addClass('emotion-label');

      buttons['Boredom'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/turnip.PNG', 'Boredom').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Boredom'));
      labels['Boredom'] = createDiv('Boredom').addClass('emotion-label');

      buttons['Annoyance'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/fork.PNG', 'Annoyance').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Annoyance'));
      labels['Annoyance'] = createDiv('Annoyance').addClass('emotion-label');

      buttons['Interest'] = createImg('https://raw.githubusercontent.com/mooo0ooo/diary/main/glove.PNG', 'Interest').size(emotionSize, emotionSize).mousePressed(() => handleEmotionButton('Interest'));
      labels['Interest'] = createDiv('Interest').addClass('emotion-label');
    }

    // 英語に変換する関数
    function toEnglishEmotion(emotion) {
      if (currentLanguage === 'ja') {
        return emotionTranslationMap[emotion] || emotion;
      }
      return emotion;
    }

    function handleEmotionButton(emotionLabel) {
      // 日本語ラベルを英語に変換
      let emotion = toEnglishEmotion(emotionLabel);
      if (!selectedEmotions[emotion]) selectedEmotions[emotion] = 0;
      selectedEmotions[emotion]++;

      startEffect(emotion);
    }

    function startEffect(emotion) {
      effectColor = emotionColors[emotion];
      effectShapes = [];
      for (let i = 0; i < 50; i++) {
        effectShapes.push({
          x: random(width),
          y: random(height),
          size: random(3, 12),
          type: random(['star', 'hexagon', 'diamond', 'circle']),
          filled: random() > 0.5  // 塗りつぶし or 線だけ
        });
      }
      effectStartTime = millis();
      isEffectActive = true;
    }

    function drawEffects() {
      for (let shape of effectShapes) {
        if (shape.filled) {
          fill(effectColor);
          noStroke();
        } else {
          noFill();
          stroke(effectColor);
          strokeWeight(2);
        }

        push();
        translate(shape.x, shape.y);
        switch (shape.type) {
          case 'star':
            drawStar(0, 0, shape.size / 2, shape.size, 5);
            break;
          case 'hexagon':
            drawPolygon(0, 0, shape.size / 2, 6);
            break;
          case 'diamond':
            rotate(PI / 4);
            rect(0, 0, shape.size, shape.size);
            break;
          case 'circle':
            ellipse(0, 0, shape.size);
            break;
        }
        pop();
      }
    }

    function drawStar(x, y, radius1, radius2, npoints) {
      let angle = TWO_PI / npoints;
      let halfAngle = angle / 2.0;
      beginShape();
      for (let a = 0; a < TWO_PI; a += angle) {
        let sx = x + cos(a) * radius2;
        let sy = y + sin(a) * radius2;
        vertex(sx, sy);
        sx = x + cos(a + halfAngle) * radius1;
        sy = y + sin(a + halfAngle) * radius1;
        vertex(sx, sy);
      }
      endShape(CLOSE);
    }

    function drawPolygon(x, y, radius, npoints) {
      let angle = TWO_PI / npoints;
      beginShape();
      for (let a = 0; a < TWO_PI; a += angle) {
        let sx = x + cos(a) * radius;
        let sy = y + sin(a) * radius;
        vertex(sx, sy);
      }
      endShape(CLOSE);
    }

    function displayResult() {
      clear();

      let img = backgroundImages[backgroundChoice];
      let imgAspect = img.width / img.height;
      let canvasAspect = width / height;
      let imgWidth, imgHeight;

      if (imgAspect > canvasAspect) {
        imgWidth = width;
        imgHeight = width / imgAspect;
      } else {
        imgHeight = height;
        imgWidth = height * imgAspect;
      }

      image(img, (width - imgWidth) / 2, (height - imgHeight) / 2, imgWidth, imgHeight);

      // モチーフの決定と表示
      let mostSelectedEmotion = getMostSelectedEmotion();
      let motif = motifImages[mostSelectedEmotion];
      if (motif) {
        image(motif, width / 2 - motif.width / 2, height / 2 - motif.height / 2);
      }

      for (let key in buttons) {
        buttons[key].hide();
        labels[key].hide();
      }

      checkButton.hide();
      select('#language-btn').style('display', 'none');

      let downloadBtn = select('#download-btn');
      downloadBtn.style('display', 'block');
      downloadBtn.mousePressed(() => saveCanvas('result', 'png'));

      isResultDisplayed = true;
    }

    function getMostSelectedEmotion() {
      let maxCount = -1;
      let selectedEmotion = '';
      for (let emotion in selectedEmotions) {
        if (selectedEmotions[emotion] > maxCount) {
          maxCount = selectedEmotions[emotion];
          selectedEmotion = emotion;
        }
      }
      return selectedEmotion;
    }

    function toggleLanguage() {
      if (currentLanguage === 'en') {
        currentLanguage = 'ja';
        emotionsA = emotionsA_ja;
        emotionsB = emotionsB_ja;
        emotionsC = emotionsC_ja;
        select('#language-btn').html('English');
      } else {
        currentLanguage = 'en';
        emotionsA = emotionsA_en;
        emotionsB = emotionsB_en;
        emotionsC = emotionsC_en;
        select('#language-btn').html('Japanese');
      }
      updateEmotionLabels();
      draw();
    }

    function updateEmotionLabels() {
      for (let i = 0; i < emotionsA.length; i++) {
        labels[emotionsA_en[i]].html(emotionsA[i]);
      }
      for (let i = 0; i < emotionsB.length; i++) {
        labels[emotionsB_en[i]].html(emotionsB[i]);
      }
      for (let i = 0; i < emotionsC.length; i++) {
        labels[emotionsC_en[i]].html(emotionsC[i]);
      }
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      drawEmotionGrid(emotionsA, 0);
      drawEmotionGrid(emotionsB, 1);
      drawEmotionGrid(emotionsC, 2);
    }
  </script>
</body>
</html>
